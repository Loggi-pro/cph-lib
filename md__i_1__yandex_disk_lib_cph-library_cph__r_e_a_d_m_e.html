<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cph_lib: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cph_lib
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Peripheral abstraction library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>(Click to expand):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Command  </th><th class="markdownTableHeadCenter">AVR  </th><th class="markdownTableHeadCenter">STM8  </th><th class="markdownTableHeadCenter">STM32 (M3/M4)  </th><th class="markdownTableHeadCenter">WIN32   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SM  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><code>NOT TESTED</code>  </td><td class="markdownTableBodyCenter"><code>NOT TESTED</code>  </td><td class="markdownTableBodyCenter">VC++   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SPI  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><code>NYI</code>  </td><td class="markdownTableBodyCenter"><code>NYI</code>  </td><td class="markdownTableBodyCenter">&ndash;   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">UART  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><code>NYI</code>  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><code>STUB</code>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">GPIO  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><code>NYI</code>  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter">-   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<hr  />
<h1><a class="anchor" id="autotoc_md3"></a>
Quick Start</h1>
<hr  />
<h1><a class="anchor" id="autotoc_md5"></a>
State Machine</h1>
<ul>
<li><em>Header</em>: <b><a class="el" href="sml_8h_source.html">cph/sml.h</a></b></li>
<li><em>Require</em>: C++17</li>
<li><em>Description</em>:<ol type="1">
<li>Boost Compile-time simple finite state machine</li>
<li>More examples\descriptions <a href="https://boost-experimental.github.io/sml/examples/index.html">https://boost-experimental.github.io/sml/examples/index.html</a></li>
</ol>
</li>
<li><em>Example</em>: &lt;details&gt;</li>
</ul>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">namespace sml = boost::sml;</div>
<div class="line"> </div>
<div class="line">struct sender {</div>
<div class="line">    void send(const char* msg) { cout &lt;&lt; msg &lt;&lt; cph::endl; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">//events</div>
<div class="line">struct ack { bool valid{}; };</div>
<div class="line">struct fin { int id{}; bool valid{}; };</div>
<div class="line">struct release {};</div>
<div class="line">struct timeout {};</div>
<div class="line">//guard</div>
<div class="line">const auto is_ack_valid = [](const ack&amp; a) {return a.valid; };</div>
<div class="line">const auto is_fin_valid = [](const fin&amp; a) {return a.valid; };</div>
<div class="line">//actions</div>
<div class="line">const auto send_fin = []() {</div>
<div class="line">    //s.send(&quot;send fin&quot;);</div>
<div class="line">};</div>
<div class="line">const auto send_ack = [] () {</div>
<div class="line">};</div>
<div class="line">//state machine</div>
<div class="line">class established;</div>
<div class="line">class fin_wait_1;</div>
<div class="line">class fin_wait_2;</div>
<div class="line">class timed_wait;</div>
<div class="line"> </div>
<div class="line">struct tcp_release {</div>
<div class="line">    auto operator ()() const {</div>
<div class="line">        using namespace sml;</div>
<div class="line">        //init state</div>
<div class="line">        //transition DSL : src_state+event [guard] / action =dst_state</div>
<div class="line">        return make_transition_table(</div>
<div class="line">                   *state&lt;established&gt; +event&lt;release&gt; / send_fin = state&lt;fin_wait_1&gt;,</div>
<div class="line">                   state&lt;fin_wait_1&gt; +event&lt;ack&gt;[is_ack_valid] = state&lt;fin_wait_2&gt;,</div>
<div class="line">                   state&lt;fin_wait_2&gt; +event&lt;fin&gt;[is_fin_valid] / send_ack = state&lt;timed_wait&gt;,</div>
<div class="line">                   state&lt;timed_wait&gt; +event&lt;timeout&gt; / send_ack = X</div>
<div class="line">               );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//usage</div>
<div class="line"> </div>
<div class="line">    using namespace boost::sml;</div>
<div class="line">    sm&lt;tcp_release&gt; fsm(sender{});      //pass dependencies via constructor;</div>
<div class="line">    sm&lt;tcp_release&gt; sm ( s );        //pass dependencies via constructor;</div>
<div class="line">    assert(sm.is(state&lt;established&gt;));</div>
<div class="line">    sm.process_event(release{}); // complexity O(1)</div>
<div class="line">    assert(sm.is(state&lt;fin_wait_1&gt;));</div>
<div class="line">    sm.process_event(ack{true }); // prints &#39;send: 0&#39;</div>
<div class="line">    assert(sm.is(state&lt;fin_wait_2&gt;));</div>
<div class="line">    sm.process_event(fin{42, true}); // prints &#39;send: 42&#39;</div>
<div class="line">    assert(sm.is(state&lt;timed_wait&gt;));</div>
<div class="line">    sm.process_event(timeout{});</div>
<div class="line">    assert(sm.is(X));  // terminated</div>
</div><!-- fragment --><p>&lt;/details&gt;</p>
<ul>
<li>## <em>Comment</em>:</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
SPI</h1>
<ul>
<li><em>Header</em>: <b><a class="el" href="spi_8h_source.html">cph/spi.h</a></b></li>
<li><em>Require</em>:</li>
<li><em>Description</em>:<ol type="1">
<li>SPI</li>
</ol>
</li>
<li><em>Example</em>: &lt;details&gt;</li>
</ul>
<p>(Click to expand): </p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">//������</div>
<div class="line">#include &lt;cph/spi.h&gt;</div>
<div class="line">using namespace cph;</div>
<div class="line"> </div>
<div class="line">typedef Spi::Private::TSpiMaster TSpi;</div>
<div class="line"> </div>
<div class="line">TSpi::init&lt;SpiSpeed_4MHz, F_CPU, TSpi::Flags::LsbFirst&gt;();</div>
<div class="line">TSpi::enable();</div>
<div class="line">uint8_t i = 0;</div>
<div class="line">if (TSpi::readByte(&amp;i)) {</div>
<div class="line">    //...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//����������� ������:</div>
<div class="line">//�����������: ��� ���� ������ ���� �� ����� �����</div>
<div class="line">//LSByte Order �� ��������</div>
<div class="line">//�� �����������</div>
<div class="line">#include &lt;cph/spi.h&gt;</div>
<div class="line">#include &lt;cph/ioreg.h&gt;</div>
<div class="line"> </div>
<div class="line">IO_REG_WRAPPER(DDRA, SPI_DDR, uint8_t);</div>
<div class="line">IO_REG_WRAPPER(PORTA, SPI_PORT, uint8_t);</div>
<div class="line"> </div>
<div class="line">typedef Spi::Private::Registers&lt;SPI_DDR, SPI_PORT, PA0, PA1, PA2, PA3&gt; SpiReg;</div>
<div class="line">typedef Spi::Private::TProgramSpiMasterBase &lt; SpiReg, SpiSpeed_4MHz&gt; TProgramSpi;</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//������ � ��������� ����� CS</div>
<div class="line">#include &lt;cph/spi.h&gt;</div>
<div class="line">#include &lt;cph/ioreg.h&gt;</div>
<div class="line">using namespace cph;</div>
<div class="line">IO_REG_WRAPPER(DDRB, ddrb, uint8_t);</div>
<div class="line">IO_REG_WRAPPER(PORTB, portb, uint8_t);</div>
<div class="line"> </div>
<div class="line">typedef Spi::Private::SpiMasterBase&lt; PB0, portb, ddrb, false&gt; TSpi; //Spi with CS on pin PB0</div>
<div class="line"> </div>
<div class="line">TSpi::init&lt;SpiSpeed_4MHz, F_CPU, TSpi::Flags::LsbFirst&gt;();</div>
<div class="line">TSpi::enable();</div>
<div class="line">uint8_t i = 0;</div>
<div class="line">if (TSpi::readByte(&amp;i)) {</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//����������� �����</div>
<div class="line">#include &lt;cph/spi.h&gt;</div>
<div class="line">#include &lt;cph/interrupt.h&gt;</div>
<div class="line">using namespace cph;</div>
<div class="line">VOID_ISR(CPH_INT_SPI) {</div>
<div class="line">    SpiSlaveAsync::IntHandler();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint8_t a = 0;</div>
<div class="line"> </div>
<div class="line">bool trancieveCb(uint8_t* data) {</div>
<div class="line">    *data = a++;</div>
<div class="line">    a %= 10;</div>
<div class="line">    return true; //every time this callback returns true, SPI will be in sending mode, and will be called transmit callback</div>
<div class="line">}   //if return = false, then on next interrupt will be called receive callback</div>
<div class="line"> </div>
<div class="line">//example of spi on interrupts</div>
<div class="line">    SpiSlaveAsync::init&lt;SpiSpeed_4MHz&gt;();</div>
<div class="line">    SpiSlaveAsync::enable();</div>
<div class="line">    SpiSlaveAsync::writeByte(0);</div>
<div class="line">    //set data for trancieve, so on interrupt will be called trancieve callback;</div>
<div class="line">    //on other way will be called receive_callback;</div>
<div class="line">    SpiSlaveAsync::setCallback(nullptr, trancieveCb);</div>
<div class="line">    vd::EnableInterrupts();</div>
<div class="line"> </div>
<div class="line">    while (true) {</div>
<div class="line">    }</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//������ ������������������ ������������ ������</div>
<div class="line">#include &lt;cph/spi.h&gt;</div>
<div class="line">#include &lt;void/interrupt.h&gt;</div>
<div class="line">#include &lt;cph/containers/buffer.h&gt;</div>
<div class="line">using namespace cph;</div>
<div class="line"> </div>
<div class="line">VOID_ISR(CPH_INT_SPI) {</div>
<div class="line">    SpiSlaveAsync::IntHandler();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TBuffer&lt;uint8_t, 254, vd::Atomic&gt; buf;</div>
<div class="line"> </div>
<div class="line">void receiveCb(const uint8_t&amp; data) {</div>
<div class="line">    buf.push(data);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">//example of spi on interrupts</div>
<div class="line">//...</div>
<div class="line">SpiSlaveAsync::init&lt;cph::SpiSpeed_2MHz&gt;();</div>
<div class="line">SpiSlaveAsync::enable();</div>
<div class="line">//set data for trancieve, so on interrupt will be called trancieve callback;</div>
<div class="line">//on other way will be called receive_callback;</div>
<div class="line">SpiSlaveAsync::setCallback(receiveCb, nullptr);</div>
<div class="line">vd::EnableInterrupts();</div>
<div class="line">uint8_t data;</div>
<div class="line"> </div>
<div class="line">//...</div>
<div class="line">if (buf.pop(&amp;data)) {</div>
<div class="line">    //do action</div>
<div class="line">}</div>
</div><!-- fragment --><p>&lt;/details&gt;</p>
<hr  />
<h1><a class="anchor" id="autotoc_md8"></a>
State Machine</h1>
<ul>
<li><em>Header</em>: <b><a class="el" href="sml_8h_source.html">cph/sml.h</a></b></li>
<li><em>Require</em>: C++17</li>
<li><em>Description</em>:<ol type="1">
<li>Boost Compile-time simple finite state machine</li>
<li>More examples\descriptions <a href="https://boost-experimental.github.io/sml/examples/index.html">https://boost-experimental.github.io/sml/examples/index.html</a></li>
</ol>
</li>
<li><em>Example</em>: &lt;details&gt;</li>
</ul>
<p>(Click to expand): </p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">namespace sml = boost::sml;</div>
<div class="line"> </div>
<div class="line">struct sender {</div>
<div class="line">    void send(const char* msg) { cout &lt;&lt; msg &lt;&lt; cph::endl; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">//events</div>
<div class="line">struct ack { bool valid{}; };</div>
<div class="line">struct fin { int id{}; bool valid{}; };</div>
<div class="line">struct release {};</div>
<div class="line">struct timeout {};</div>
<div class="line">//guard</div>
<div class="line">const auto is_ack_valid = [](const ack&amp; a) {return a.valid; };</div>
<div class="line">const auto is_fin_valid = [](const fin&amp; a) {return a.valid; };</div>
<div class="line">//actions</div>
<div class="line">const auto send_fin = []() {</div>
<div class="line">    //s.send(&quot;send fin&quot;);</div>
<div class="line">};</div>
<div class="line">const auto send_ack = [] () {</div>
<div class="line">};</div>
<div class="line">//state machine</div>
<div class="line">class established;</div>
<div class="line">class fin_wait_1;</div>
<div class="line">class fin_wait_2;</div>
<div class="line">class timed_wait;</div>
<div class="line"> </div>
<div class="line">struct tcp_release {</div>
<div class="line">    auto operator ()() const {</div>
<div class="line">        using namespace sml;</div>
<div class="line">        //init state</div>
<div class="line">        //transition DSL : src_state+event [guard] / action =dst_state</div>
<div class="line">        return make_transition_table(</div>
<div class="line">                   *state&lt;established&gt; +event&lt;release&gt; / send_fin = state&lt;fin_wait_1&gt;,</div>
<div class="line">                   state&lt;fin_wait_1&gt; +event&lt;ack&gt;[is_ack_valid] = state&lt;fin_wait_2&gt;,</div>
<div class="line">                   state&lt;fin_wait_2&gt; +event&lt;fin&gt;[is_fin_valid] / send_ack = state&lt;timed_wait&gt;,</div>
<div class="line">                   state&lt;timed_wait&gt; +event&lt;timeout&gt; / send_ack = X</div>
<div class="line">               );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">};</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//usage</div>
<div class="line"> </div>
<div class="line">    using namespace boost::sml;</div>
<div class="line">    sm&lt;tcp_release&gt; fsm(sender{});      //pass dependencies via constructor;</div>
<div class="line">    sm&lt;tcp_release&gt; sm ( s );        //pass dependencies via constructor;</div>
<div class="line">    assert(sm.is(state&lt;established&gt;));</div>
<div class="line">    sm.process_event(release{}); // complexity O(1)</div>
<div class="line">    assert(sm.is(state&lt;fin_wait_1&gt;));</div>
<div class="line">    sm.process_event(ack{true }); // prints &#39;send: 0&#39;</div>
<div class="line">    assert(sm.is(state&lt;fin_wait_2&gt;));</div>
<div class="line">    sm.process_event(fin{42, true}); // prints &#39;send: 42&#39;</div>
<div class="line">    assert(sm.is(state&lt;timed_wait&gt;));</div>
<div class="line">    sm.process_event(timeout{});</div>
<div class="line">    assert(sm.is(X));  // terminated</div>
</div><!-- fragment --><p>&lt;/details&gt;</p>
<ul>
<li>## <em>Comment</em>:</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
GPIO</h1>
<ul>
<li><em>Header</em>: <b><a class="el" href="gpio_8h_source.html">cph/gpio.h</a></b></li>
<li><em>Require</em>:</li>
<li><em>Description</em>:<ol type="1">
<li>���������� ���������� ������ � ������� ���� <code>cph::io::Pxn</code>=&gt; (�������� <code>cph::io::Pa0</code>)</li>
<li>��������������� ��� ���� <code>cph::io::Pa0Inv</code></li>
<li>���������� ������� ����� � ������� ���� <code>ph::io::PinList&lt;cph::io::Pe11, cph::io::Pe12,cph:io::Pe13&gt;</code></li>
<li>�������������� ����� � ������ ����� <code>VPortBase</code> � ���� <code>VPin</code></li>
<li>�������������� ������ ����� � compile-time ����: <code>typedef group_t::AsList compile_list_t</code></li>
</ol>
</li>
<li><em>Example</em>: &lt;details&gt;</li>
</ul>
<p>(Click to expand): </p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line">   //���������� ��������� �����</div>
<div class="line">   typedef cph::io::Pe11 Led;</div>
<div class="line">   Led::Port::Enable();</div>
<div class="line">   Led::SetConfiguration(Led::Port::Out);</div>
<div class="line">   Led::SetSpeed(Led::Speed::Slow);</div>
<div class="line">   Led::Set();</div>
</div><!-- fragment --><div class="fragment"><div class="line">{c++}</div>
<div class="line">   //���������� ������� �����</div>
<div class="line">   typedef cph::io::PinList&lt;cph::io::Pe11, cph::io::Pe12,cph:io::Pe13&gt; group;</div>
<div class="line">   group::SetConfiguration(group::Out);</div>
<div class="line">   group::Write&lt;0x11&gt;();</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {c++}</div>
<div class="line">//�������� compile-time ������ � �������� ��� ��� ����� ������</div>
<div class="line">typedef cph::io::PinList&lt;cph::io::Pe11, cph::io::Pe12,cph::io::Pe13&gt;::AsList pinlist_t</div>
<div class="line">auto predicate2 = [] (auto element,auto tail) {</div>
<div class="line">        typedef decltype (element) firstPin;</div>
<div class="line">        auto comparer = [](auto element2){</div>
<div class="line">            typedef decltype(element2) secondPin;</div>
<div class="line">            return firstPin::Number==secondPin::Number;</div>
<div class="line">        };</div>
<div class="line">        return vd::find(tail,comparer);</div>
<div class="line">    };</div>
<div class="line">VOID_STATIC_ASSERT(vd::foreach(pinlist_t{},predicate2)==false);</div>
</div><!-- fragment --><p>&lt;/details&gt; </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
